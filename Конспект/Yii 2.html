Yii 2

/************************************************
17.06.17 (1 - MVC на стороне JS, введение Yii 2)
************************************************/
Все методы в Yii 2 делятся на действия (action) и просто методы.
После установки Yii 2 в файле config\web.php нужно задать ключ для шифрования cookies.
В Yii 2 по умолчанию есть bootstrap.
В файле config\db.php настраивается подключение к БД. Это может быть не обязательно MySQL, а любая другая СУБД.
composer.json - файл в котором прописаны все зависимости для composer.
Вся папка вьюх называется по имени коттроллера. Каждому экшину котнроллера соответствует определенная вьюха.
Action-методы - это методы, которые что-то выводят на страницу.
Gii - инструмент для генерации кода, создания CRUDа.
ЧПУ для домена сайта: https://toster.ru/q/210872
Модуль - ограничивает во что то цельное всю группу - модель, вьюха, контроллер.
Метод rules() в моделях выполняет валидацию форм, по заданным правилам.
Список всех правил валидации форм: http://www.fantomslim.ru/articles/yii2-pravila-validaczii-svojstv-modeli

/********************************************************************************
22.06.17 (2 - Загрузка кастомного шаблона, подключение БД, виджет пагинации, Gii)
********************************************************************************/
Точка входа в приложении Yii находится в папке web.
Виджеты - это набор классов, которые обладают большим количеством статических методов и используются для создания вьюх.
Yii::$app - единственный синглтоновский экземпляр приложения, который создается для конкретного сеанса. Не пересоздается при каждом перезаходе пользователя на сайт.
Сингл тон - паттерн ООП, который при создании экзкмпляра отслеживает, что если объект уже есть, то используется он, а не создается новый. Сингл тон всегда обеспечивает наличие только одного экземпляра класса.
Yii2 Basic - это одно приложение или backend или frontend.
Font Awesome - шрифт с иконками.
Кастомные шаблоны для Yii2: https://кодер.укр/%D0%B7%D0%B0%D0%BF%D0%B8%D1%81%D0%B8/yii2-%D0%B2%D0%BD%D0%B5%D0%B4%D1%80%D0%B5%D0%BD%D0%B8%D0%B5-html-%D1%88%D0%B0%D0%B1%D0%BB%D0%BE%D0%BD%D0%B0-gentelella-%D0%B8-adminlte-%D0%B4%D0%BB%D1%8F-cms-%D0%B0%D0%B4%D0%BC%D0%B8%D0%BD%D0%BA%D0%B8
Gii - механизм генерации кода в Yii2.
Bootstrap, который не CSS - собирает и подключает все необходимые файлы. Bootstrap - первоначальная сборка.

/**************************************************************************************
24.06.17 (3 - Связь таблиц, создание своего виджета, создание модуля, дерево категорий)
**************************************************************************************/
В таблицах БД только индексированные поля можно связывать друг с другом.
ALTER - SQL-команда, которая как-то изменяет таблицу.
Есть 3 вида индекса - первичный (Primary key), уникальный (Unique index), и присто индекс (index).
Во вьюхе можно вывести любое поле связанной таблицы с помощью следующего массива:
[
    'attribute' => 'country_code',
    'value' => 'countryCode.name',
    'label' => 'Страна'
], где
attribute - имя связанного поля
value - имя геттера без префикса 'get' с маленькой буквы. Через точку указывается имя выводимого поля в связанной таблице.
label - отображаемое название столбца на вьюхе.

Методы hasOne и hasMany класса ActiveRecord позволяют указать связь таблиц.
Конструкция <?= 'bla-bla' ?> равносильна конструкции <?php echo 'bla-bla'; ?>.

Если в проекте много MVC-структур, то они объединяются в отдельные модули. Весь проект будет иметь структуру HMVC (HierarhicalMVC).
Фильтры - это код, который должен быть выполнен до и после обработки запроса пользователя контроллером.
Виджеты - это объекты, которые используются в представлениях. Можно создавать свои виджеты.
Путь к странице модуля состоит из: идентификатор модуля/идентификатор котнроллера/экшен.
Параметр в настройках виджета:
'formatter' => ['class' => 'yii\i18n\Formatter', 'nullDisplay' => '-'],
задет что будет выводиться когда поле не установлено.

/**************************************************************************************************
29.06.17 (4 - Приложения, контроллеры, модели, представления, модули, фильтры, ресурсы, расширения,
установка расширения JUI(DatePicker), установка расширения JStree(дерево категорий))
**************************************************************************************************/
Приложения являются сервис локаторами. Они состоят из множества компонентов приложения, которые представляют различные средства для обработки запросов.
Компоненты отвечают за какие-то функциональные возможности самого приложения. При этом приложение является просто контейнером, который содержит множество компонентов.
Bootstrap в Yii - это список изначально загружаемых приложений (классов).

Контроллер отвечает за то какие данные откуда брать и куда их подставлять.
Экшин отвечает за подгрузку определенной вьюхи.
Вьюхи должны быть расположены в паке имя которой соответствует имени контроллера.
В экшине при рендере может вызываться другая вьюха.
Правила валидации данных описываютс в модели в методе rules().
Метод $model->save() выполняет валидицию данных перед сохранением.
Также контроллеры отвечают за маршрутизацию (роутинг) по сайту.

Модель отвечает за сбор и валидацию данных.
Данные модели как правило хранятся в атрибутах (свойствах) модели.
Доступ к атрибуту можно получить как к свойству ($model->name) так и как к эл-ту ассоциативного массива ($model['name']).
Данные модели можно обходить с помощью цикла foreach.
Метка - название атрибута, отображаемое для пользователя.
\Yii::t - (translate) метод для поддержки мультиязычности (переводов).
ORM (Object Relative Model) - возвращает данные хранящиеся в БД, или JSON-файле, или XML в виде объекта.
При создании модели через Gii класс модели наследует класс ActiveRecord, a ActiveRecord наследует Model.

Представление прдназначено для отображения данных. Вьюха не должна иметь доступа к данным. Она получает их от контроллера.

Модуль - законченный программный блок. Каждый модуль содержит в себе отдельную структуру MVC.
Модульная структура позволяет легко масштабировать код.

Фильтры - это объекты, которые могут запускаться как перед так и после действий контроллера.
Фильтры это особый вид поведкния. Поведение отвечает за работу экшинов.
Фильтры описанные в методе behaviors() будут применяться ко всем экшенам контроллера.
Фильтры выполняют какую-либо фильтрацию данных, например: фильтрацию товаров по ценам.
Аутентификация - определение роли пользователя.
Авторизация - наделение пользователя возможностями в соответствии с его ролью.

Ресурсы - JS, CSS, медиа-файлы, которые могут использоваться на странице.
Ресурсы регистрируются. Могут регистрироваться как для отдельных вьюх, так и для виджетов.
При загрузке главной страницы не грузится ничего лишнего, а необходимые JS и CSS файлы будут грузиться только там где они зарегистрированы.
Вьюха main рендерится всегда - это оболочка всего приложения.
composer.phar - расширение .phar это PHP-архив.
Расширение "jui" содержит в себе фишки JQueryUI в виде виджетов.
Стили подключаются в <head> скрипты в окончание <body>.
JQueryUI имеет языковые пакеты - в зависимости от языка грузятся разные календари.
В Yii_2 возможна условная подгрузка ресурсов - c помощью комментариев в html файле.

Расширения - это распространяемые программные пакеты.
"Command-line installation" для композера это локальная установка в проект.

GULP - сборщик проектов делает минимизацию файлов, автопрефиксацию и т.д.
composer self-update - обновление самого композера.
composer update - обновление зависимостей.

Расширение JStree (дерево категорий): https://yiigist.com/package/thiagotalma/yii2-jstree#!?tab=readme

/**************************************************************************************
01.07.17 (5 - разбирались с работой плагина JStree, создание своего виджета TreeWidget)
***************************************************************************************/
Точка входа в  Yii приложение находится в папке - web/index.php
Когда запускаем composer update для всего проект, то композер смотрит какие расширения установлены, ищет файл composer.json конкретного расширения, берет там путь репозитория и проверяет необходимо ли обновление.
Метод init в виджетах выполняет инициализацию данных виджета при запуске.
Если в виджете есть begin и end (как виджет форм), то метод init отрабатывает при вызове begin, а метод run - при вызове end.
Метод run в виджетах используется для вывода HTML кода.
Function Expression (анонимная ф-я) отрабатывает там где объявляется, в момент дохода до неё интерпретатора кода.
UNIX системы регистрозависимы к именам папок и адресам.
Область видимости переменной в PHP ограничивается фигурными скобками.

/********************************************************
06.07.17 (6 - SCSS создание сетки, ассеты для TreeWidget)
********************************************************/
Если файлы названы начиная с "_", то они не будут компилироваться компилятором Коала.
Для ускорения загрузки сайта желательно, чтоб CSS-файл был один.
Один файл 500 Кб загрузится быстрее, чем 5 файлов по 100 Кб.
@media screen - медиа запрос (CSS).
#{$suffix} - литерал - строковое значение переменной $suffix.

Класс Widget обладает двумя способами вывода:
1. Метод widget.
2. Методы begin и end. При этом метод end запускает метод run виджета.

Веб-доступный ресурс это ресурс к которому пользователь может обратиться, добраться (папака web).
При объявлении класса ресурсов свойства 'basePath' и 'baseUrl' задаются только для ассетов, которые хранятся в папке web, иначе задается свойство 'sourcePath'.
Св-во $sourcePath это путь к не веб-доступному источнику ресурсов.
Зависимость от bootstrap в классе ресурсов - это bootstrap CSS.
Если объявить зависимость от CSS bootstrap, то при загрузке страницы если на ней еще не подгружен bootstrap, то он подгрузится.
В виджете ресурсы регистрируются, как правило, в методе run().
При рендере страницы Yii переносит ресурсы из НЕ веб-доступной папки в web/assets.

/******************************************************************
08.07.17 (7 - работа с БД, запросы, транзакции, изоляция, миграция)
******************************************************************/
DAO - объект доступа к данным. Работает на основе PDO.
Yii::$app->db - доступ к подключению, как к компоненту приложения.
begget - хостинг.
Все значения из БД возвращаются как строки.
Объект PDO (пхпшный) позволяет использовать в запросах плейсхолдеры: нумерованные - знак вопроса (?) и именованные - :ИмяПлейсхолдера.
batch-процессы - какие-то массовые (пакетные) процессы.
При создании подключения к БД можно указать префикс, который необходимо использовать для имен таблиц. Если префиксы есть в БД. При написании запроса вручную нужно подставлять "%" на место префикса.

"Грязное чтение" - это когда у запроса внутри транзакции есть возможность прочитать данные перезаписанные предидущим запросом. Один и тот же запрос на разных стадиях транзакции возвращает разные данные.
Неповторяющееся чтение - это когда один из запросов может не дать другому прочесть данные. Например, если один запрос удаляет данные, а второй пытается их прочесть.
Фантомное чтение - это когда один запрос добавляет какую-либо инфу в БД, а второй запрос в транзакции её читает. "Фантомное" - потому что инфы в БД по факту еще нет, так как транзакция еще не прошла.

Yii позволяет ставить уровни изоляции, которые предотвращают данне ошибки.
Класс Query - построитель запросов.
Миграция - команды для внесения изменений в БД. Используется для синхронизации БД на разных компьютерах.

/*********************************************************************************
13.07.17 (8,9 - Разработка проекта Voltage, установка date-time picker расширение)
**********************************************************************************/
Тип varchar SQL (variable chars) - переменное количество символов.
Таблицы для Yii2 должны именоваться в единственном числе.
В advanced Yii2 приложении модели могут быть одни для front и back приложений.
Пространство "app" - это backend приложение.(?)
Yii возвращает все данные из БД как строки.
Когда задаем формат даты типа "YYYY-MM-DD H:m" большая буква "Н" означает, что время будет браться в 24-часовом формате.
Нормальный date-time picker - расширение с официального сайта yii.

/********************************************************************************************
20.07.17 (10, 11)
    - установка расширений: CKEditor, ElFinder, Dropzone, Transliterator Helper
    - Автоматическая генерация алиаса из тайтла на стороне JS
    - Автоматическая запись полей created_at и updated_at в БД
********************************************************************************************/
access => ['?']: ? - гость, @ - авторизованный пользователь.
ElFinder - расширение для работы с файловой системой.
Расширене ElFinder позволяет настроить его таким образом, чтобы у каждого пользователя была своя папка, в которую он может загружать файлы.
URL в браузере можно менять с помощью JS.
Аттрибут readonly используется для полей формы, которые доступны только для чтения. Аналог disable.

Дату создания записи в БД и дату обновления Yii2 может генрировать сам. Для этого нужно, чтобы в таблице были поля "created_at" и "updated_at" и прописать определенное поведение в методе behaviors соответстующей модели. Если поля названы по другому, можно задать с помощью настроек.
Дата updated_at изменяется при нажатии на кнопку Save даже если ничего не изменилось, это связано с разностью типов даннных в БД и Yii (числа как строки). Но это уже исправили! (Если ничего не изменилось дата update_at не меняется).
Внутрении ссылки по сайту нельзя делать target_blank, потому что поисковыми системами это считается накруткой посещений. Внешние ссылки - можно.
Поля created_at и updated_at не должны проверяться в методе rules.

/******************************************************************************
19.08.17 (12)
    - Аутентификация
    - Авторизация (ACF, RBAC)
    - Работа с паролями
******************************************************************************/
Аутентификация - процесс проверки подлинности пользователя.
Авторизация - наделение пользователя правами.

Аутентификация через сессию используется, чтобы пользователь переходя по страницам сайта оставался аутентифицированным.
Токен - некоторый хеш, который уникален для данного пользователя.
Чтобы использовать событие, например EVENT_BEFORE_LOGIN нужно в классе определить метод beforeLogin, он сработает, когда будет брошено событие.
Роли наследуют разрешения, по аналогии, как классы наследуют методы.
Хеш не дешифруется.

/*******************************************************************************
24.08.17 (13)
    - Делали тестовое задание про блюда и ингридиенты.
    - Создание миграций.
    - Связь таблиц через промежуточную таблицу.
*******************************************************************************/
Приложение Advanced должно быть, по идее, более производительным, потому что два приложения работают параллельно, а не одно приложение на frontend и backend (как в basic).
Если для одного блюда может быть неограниченное количество ингридиентов, то такую связь лучше организовать через третью таблицу, которая будет содержать два поля id-блюда и id-ингридиента.
Новая миграция создается при помощи консольной команды yii migrate/create.
При создании миграции в консольной команде сразу можно указать имя новой таблицы, поля, внешние ключи. Создастся миграция для соответствующей таблицы.
Для осуществления в БД связи многие - ко многим испоьзуется промежуточная таблица.
Для связи таблиц через промежуточную таблицу используются методы via() и viaTable().
Метод ActiveRecord::link() устанавливает связь между двумя моделями.

/*******************************************************************************
26.08.17 (14)
    - Продолжение тестового задания про блюда и ингридиенты.
    - Формирование запросов для поиска.
    - Подключение JS и вывод результатов поиска с помощью Ajax (не Pjax).
    - Вывод результата с помощью виджета GridView.
*******************************************************************************/
HAVING - применяется для фильтрации функций и столбцов сгруппированных при помощи GROUP BY указанных в SELECT.
Другими словами применяется для агрегатных функций(COUNT(), MAX() ...) и столбцов указанных в выражении SELECT и обработанных GROUP BY.

JS добавляется в папку web/js, затем прописывается в frontend/assets/AppAsset.php.

Для вывода кастосного массива с помощью виджета GridView нужно создать объект dataProvider, в него передать выводимый маасив, затем передать объект dataProvider в виджет GridView.